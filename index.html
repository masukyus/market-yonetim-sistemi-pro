<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#9333ea">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="description" content="Oyunla≈ütƒ±rƒ±lmƒ±≈ü SKT Kontrol ve Stok Y√∂netimi">
    <title>SKT Kontrol - Gamified</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="./manifest.json">
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üèÜ</text></svg>">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- External Libraries -->
    <script src="https://unpkg.com/@zxing/library@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <style>
        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes scaleIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
        }
        
        @keyframes shimmer {
            0% {
                background-position: -1000px 0;
            }
            100% {
                background-position: 1000px 0;
            }
        }
        
        .animate-slide-in {
            animation: slideInUp 0.4s ease-out;
        }
        
        .animate-scale-in {
            animation: scaleIn 0.3s ease-out;
        }
        
        .animate-pulse-custom {
            animation: pulse 2s ease-in-out infinite;
        }
        
        .shimmer {
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            background-size: 1000px 100%;
            animation: shimmer 2s infinite;
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #9333ea 0%, #ec4899 100%);
            border-radius: 4px;
        }
        
        /* Confetti Animation */
        @keyframes confetti-fall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }
        
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background: #ec4899;
            animation: confetti-fall 3s linear;
            z-index: 9999;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-purple-50 via-blue-50 to-pink-50">
    <!-- App Container -->
    <div id="app">
        <div style="display: flex; align-items: center; justify-content: center; height: 100vh; flex-direction: column; gap: 20px; background: linear-gradient(135deg, #9333ea 0%, #ec4899 100%);">
            <div style="font-size: 48px;">‚è≥</div>
            <h1 style="color: white; font-size: 24px; margin: 0;">Uygulama y√ºkleniyor...</h1>
            <p style="color: rgba(255,255,255,0.8); margin: 0;">L√ºtfen bekleyiniz...</p>
        </div>
    </div>
    
    <!-- Toast Container -->
    <div id="toastContainer" class="fixed top-4 right-4 z-50 space-y-3"></div>
    
    <!-- Confetti Container -->
    <div id="confettiContainer"></div>

    <script>
        // Debug logging
        console.log('[APP] Market Y√∂netim Uygulamasƒ± ba≈ülatƒ±lƒ±yor...');
        
        /* ============================================
           STATE MANAGEMENT - Gamified Store
        ============================================ */
        class GameStore {
            constructor() {
                // User Stats
                this.userStats = this.loadFromStorage('userStats') || {
                    totalPoints: 0,
                    level: 1,
                    streak: 0,
                    todayScans: 0,
                    weeklyScans: 0,
                    badges: [],
                    dailyGoal: 20,
                    weeklyGoal: 100,
                    lastScanDate: null
                };
                
                // Constants - MUST be defined BEFORE generateSampleProducts()
                this.locations = ['Depo A', 'Depo B', 'Maƒüaza 1', 'Maƒüaza 2', 'Saha'];
                this.categories = ['Gƒ±da', 'ƒ∞√ßecek', 'Temizlik', 'Kozmetik', 'Diƒüer'];
                
                // Products
                this.products = this.loadFromStorage('products') || this.generateSampleProducts();
                
                // Settings
                this.currentView = 'dashboard';
                this.filterStatus = 'all';
                this.filterLocation = 'all';
                this.showAddModal = false;
                
                // Form state
                this.newProduct = {
                    barcode: '',
                    name: '',
                    category: '',
                    location: '',
                    expiryDate: ''
                };
                
                // Check daily reset
                this.checkDailyReset();
            }
            
            // Generate realistic sample products
            generateSampleProducts() {
                const productNames = [
                    'S√ºt 1L', 'Ekmek Tam Buƒüday', 'Yoƒüurt 500g', 'Peynir Beyaz', 'Zeytin Siyah',
                    'Domates Sal√ßa', 'Makarna Burgu', 'Pirin√ß Baldo', 'Un Tam Buƒüday', '≈ûeker K√ºp',
                    '√áay Siyah', 'Kahve T√ºrk', 'Su 5L', 'Kola 1L', 'Ayran 1L',
                    'Deterjan Sƒ±vƒ±', '≈ûampuan 500ml', 'Sabun Kalƒ±p', 'Pe√ßete 100l√º', 'Tuvalet Kaƒüƒ±dƒ±',
                    'Di≈ü Macunu', 'Krem El', 'Kolonya 200ml', 'Islak Mendil', 'Havlu Kaƒüƒ±t'
                ];
                
                const products = [];
                const today = new Date();
                
                productNames.forEach((name, idx) => {
                    const category = idx < 5 ? 'Gƒ±da' : 
                                   idx < 10 ? 'Gƒ±da' :
                                   idx < 15 ? 'ƒ∞√ßecek' :
                                   idx < 20 ? 'Temizlik' : 'Kozmetik';
                    
                    const location = this.locations[idx % this.locations.length];
                    
                    // Different expiry dates for variety
                    let expiryDate = new Date(today);
                    if (idx % 5 === 0) {
                        expiryDate.setDate(today.getDate() - 5); // Expired
                    } else if (idx % 5 === 1) {
                        expiryDate.setDate(today.getDate() + 15); // Warning
                    } else if (idx % 5 === 2) {
                        expiryDate.setDate(today.getDate() + 25); // Warning
                    } else {
                        expiryDate.setDate(today.getDate() + (60 + idx * 10)); // Good
                    }
                    
                    const product = {
                        id: Date.now() + idx,
                        barcode: `SKU${(10000 + idx).toString()}`,
                        name,
                        category,
                        location,
                        expiryDate: expiryDate.toISOString().split('T')[0],
                        timestamp: new Date(today.getTime() - idx * 3600000).toISOString(),
                        scannedBy: 'System'
                    };
                    
                    const statusInfo = this.calculateStatus(product.expiryDate);
                    products.push({ ...product, ...statusInfo });
                });
                
                return products;
            }
            
            // Check daily reset
            checkDailyReset() {
                const today = new Date().toDateString();
                if (this.userStats.lastScanDate !== today) {
                    this.userStats.todayScans = 0;
                    this.userStats.lastScanDate = today;
                    this.saveToStorage('userStats', this.userStats);
                }
            }
            
            // Storage operations
            loadFromStorage(key) {
                try {
                    const data = localStorage.getItem(key);
                    return data ? JSON.parse(data) : null;
                } catch (e) {
                    console.error('Storage load error:', e);
                    return null;
                }
            }
            
            saveToStorage(key, data) {
                try {
                    localStorage.setItem(key, JSON.stringify(data));
                    return true;
                } catch (e) {
                    console.error('Storage save error:', e);
                    return false;
                }
            }
            
            // Calculate product status
            calculateStatus(expiryDate) {
                const today = new Date();
                const expiry = new Date(expiryDate);
                const diffTime = expiry - today;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

                if (diffDays < 0) {
                    return { 
                        status: 'SKT GE√áTƒ∞', 
                        color: 'bg-red-500', 
                        textColor: 'text-red-600',
                        borderColor: 'border-red-500',
                        daysLeft: diffDays 
                    };
                }
                if (diffDays <= 30) {
                    return { 
                        status: 'SKT YAKLA≈ûIYOR', 
                        color: 'bg-yellow-500', 
                        textColor: 'text-yellow-600',
                        borderColor: 'border-yellow-500',
                        daysLeft: diffDays 
                    };
                }
                return { 
                    status: 'UYGUN', 
                    color: 'bg-green-500', 
                    textColor: 'text-green-600',
                    borderColor: 'border-green-500',
                    daysLeft: diffDays 
                };
            }
            
            // Calculate points
            calculatePoints(status) {
                if (status === 'SKT GE√áTƒ∞') return 50;
                if (status === 'SKT YAKLA≈ûIYOR') return 30;
                return 10;
            }
            
            // Add product
            addProduct() {
                if (!this.newProduct.barcode || !this.newProduct.name || !this.newProduct.expiryDate) {
                    showToast('L√ºtfen zorunlu alanlarƒ± doldurun!', 'error');
                    return;
                }

                if (this.products.some(p => p.barcode === this.newProduct.barcode)) {
                    showToast('Bu barkod zaten kayƒ±tlƒ±!', 'error');
                    return;
                }

                const statusInfo = this.calculateStatus(this.newProduct.expiryDate);
                const points = this.calculatePoints(statusInfo.status);

                const product = {
                    ...this.newProduct,
                    id: Date.now(),
                    timestamp: new Date().toISOString(),
                    scannedBy: 'Siz',
                    ...statusInfo
                };

                this.products.unshift(product);
                this.saveToStorage('products', this.products);
                
                // Update stats
                this.userStats.totalPoints += points;
                this.userStats.todayScans += 1;
                this.userStats.weeklyScans += 1;
                this.userStats.level = Math.floor(this.userStats.totalPoints / 100) + 1;
                
                // Check streak
                const today = new Date().toDateString();
                if (this.userStats.lastScanDate !== today) {
                    this.userStats.streak += 1;
                    this.userStats.lastScanDate = today;
                }
                
                this.saveToStorage('userStats', this.userStats);
                
                // Check achievements
                this.checkAchievements();
                
                // Show success
                showSuccessAnimation(points, statusInfo.status);
                showConfetti();
                
                // Reset form
                this.newProduct = { barcode: '', name: '', category: '', location: '', expiryDate: '' };
                this.showAddModal = false;
                
                // Re-render
                render();
            }
            
            // Delete product
            deleteProduct(id) {
                if (confirm('Bu √ºr√ºn√º silmek istediƒüinizden emin misiniz?')) {
                    this.products = this.products.filter(p => p.id !== id);
                    this.saveToStorage('products', this.products);
                    showToast('√úr√ºn silindi', 'success');
                    render();
                }
            }
            
            // Check achievements
            checkAchievements() {
                const newBadges = [];
                
                if (this.userStats.todayScans === 10 && !this.userStats.badges.includes('ƒ∞lk 10')) {
                    newBadges.push('ƒ∞lk 10');
                }
                if (this.userStats.todayScans === 20 && !this.userStats.badges.includes('G√ºnl√ºk Kahraman')) {
                    newBadges.push('G√ºnl√ºk Kahraman');
                }
                if (this.userStats.weeklyScans === 50 && !this.userStats.badges.includes('Haftalƒ±k Yƒ±ldƒ±z')) {
                    newBadges.push('Haftalƒ±k Yƒ±ldƒ±z');
                }
                if (this.userStats.weeklyScans === 100 && !this.userStats.badges.includes('S√ºper Denet√ßi')) {
                    newBadges.push('S√ºper Denet√ßi');
                }
                if (this.userStats.streak === 7 && !this.userStats.badges.includes('Ate≈ü Topu')) {
                    newBadges.push('Ate≈ü Topu');
                }

                if (newBadges.length > 0) {
                    this.userStats.badges.push(...newBadges);
                    this.saveToStorage('userStats', this.userStats);
                    
                    newBadges.forEach(badge => {
                        showToast(`üéñÔ∏è Yeni Rozet Kazandƒ±nƒ±z: ${badge}!`, 'success');
                    });
                }
            }
            
            // Get filtered products
            getFilteredProducts() {
                return this.products.filter(p => {
                    if (this.filterStatus !== 'all' && p.status !== this.filterStatus) return false;
                    if (this.filterLocation !== 'all' && p.location !== this.filterLocation) return false;
                    return true;
                });
            }
            
            // Export to Excel
            exportToExcel() {
                if (this.products.length === 0) {
                    showToast('Dƒ±≈üa aktarƒ±lacak √ºr√ºn yok', 'warning');
                    return;
                }

                const data = this.products.map(product => ({
                    'Barkod': product.barcode,
                    '√úr√ºn Adƒ±': product.name,
                    'Kategori': product.category,
                    'Lokasyon': product.location,
                    'Son Kullanma': product.expiryDate,
                    'Kalan G√ºn': product.daysLeft,
                    'Durum': product.status,
                    'Taranan Tarih': new Date(product.timestamp).toLocaleString('tr-TR')
                }));

                const ws = XLSX.utils.json_to_sheet(data);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, 'SKT Raporu');

                const fileName = `skt-raporu-${new Date().toISOString().split('T')[0]}.xlsx`;
                XLSX.writeFile(wb, fileName);

                showToast('Excel dosyasƒ± indirildi', 'success');
            }
        }

        // Initialize store
        const store = new GameStore();

        /* ============================================
           BARCODE SCANNER
        ============================================ */
        let codeReader = null;

        async function startBarcodeScanner() {
            try {
                const videoElement = document.getElementById('scannerVideo');
                
                if (!videoElement) return;
                
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: {
                        facingMode: 'environment',
                        width: { ideal: 1280 },
                        height: { ideal: 720 }
                    }
                });

                videoElement.srcObject = stream;
                codeReader = new ZXing.BrowserMultiFormatReader();

                codeReader.decodeFromVideoElement(videoElement, (result, err) => {
                    if (result) {
                        handleBarcodeScanned(result.text);
                    }
                });

            } catch (error) {
                console.error('Camera error:', error);
                showToast('Kamera eri≈üimi reddedildi', 'error');
            }
        }

        function stopBarcodeScanner() {
            if (codeReader) {
                codeReader.reset();
                codeReader = null;
            }
            
            const videoElement = document.getElementById('scannerVideo');
            if (videoElement && videoElement.srcObject) {
                videoElement.srcObject.getTracks().forEach(track => track.stop());
                videoElement.srcObject = null;
            }
        }

        function handleBarcodeScanned(barcode) {
            if ('vibrate' in navigator) {
                navigator.vibrate([50, 30, 50]);
            }
            
            store.newProduct.barcode = barcode;
            stopBarcodeScanner();
            showToast(`Barkod okundu: ${barcode}`, 'success');
            render();
        }

        function simulateBarcodeScan() {
            const randomBarcode = 'SKU' + Math.floor(Math.random() * 100000);
            store.newProduct.barcode = randomBarcode;
            showToast(`Barkod olu≈üturuldu: ${randomBarcode}`, 'success');
            render();
        }

        /* ============================================
           UI HELPERS
        ============================================ */
        function showToast(message, type = 'success') {
            const container = document.getElementById('toastContainer');
            
            const icons = {
                success: '‚úÖ',
                error: '‚ùå',
                warning: '‚ö†Ô∏è'
            };
            
            const colors = {
                success: 'bg-green-500',
                error: 'bg-red-500',
                warning: 'bg-yellow-500'
            };

            const toast = document.createElement('div');
            toast.className = `${colors[type]} text-white px-6 py-4 rounded-xl shadow-2xl flex items-center gap-3 animate-slide-in min-w-[300px]`;
            toast.innerHTML = `
                <span class="text-2xl">${icons[type]}</span>
                <span class="font-semibold">${message}</span>
            `;

            container.appendChild(toast);

            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateX(100%)';
                toast.style.transition = 'all 0.3s';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        function showSuccessAnimation(points, status) {
            const message = status === 'SKT GE√áTƒ∞' ? 'üéØ Risk Tespit Edildi!' :
                           status === 'SKT YAKLA≈ûIYOR' ? '‚è∞ Dikkat Gerekli!' :
                           '‚úÖ √úr√ºn Uygun!';
            
            showToast(`${message} +${points} XP`, 'success');
        }

        function showConfetti() {
            const container = document.getElementById('confettiContainer');
            const colors = ['#ec4899', '#9333ea', '#f59e0b', '#10b981', '#3b82f6'];
            
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * window.innerWidth + 'px';
                    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.animationDelay = Math.random() * 0.3 + 's';
                    container.appendChild(confetti);
                    
                    setTimeout(() => confetti.remove(), 3000);
                }, i * 30);
            }
        }

        /* ============================================
           RENDER FUNCTIONS
        ============================================ */
        function renderHeader() {
            return `
                <div class="bg-white shadow-lg border-b-4 border-purple-500">
                    <div class="max-w-7xl mx-auto px-4 py-4">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-3">
                                <div class="bg-gradient-to-br from-purple-600 to-pink-600 p-2 rounded-xl">
                                    <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"></path>
                                    </svg>
                                </div>
                                <div>
                                    <h1 class="text-2xl font-bold text-gray-800">SKT Kontrol√º</h1>
                                    <p class="text-sm text-gray-600">Seviye ${store.userStats.level} Denet√ßi</p>
                                </div>
                            </div>
                            <div class="flex items-center gap-4">
                                <div class="bg-gradient-to-r from-yellow-400 to-orange-400 px-4 py-2 rounded-xl flex items-center gap-2 shadow-lg">
                                    <span class="text-white">‚≠ê</span>
                                    <span class="font-bold text-white">${store.userStats.totalPoints}</span>
                                </div>
                                <div class="bg-gradient-to-r from-red-500 to-orange-500 px-4 py-2 rounded-xl flex items-center gap-2 shadow-lg">
                                    <span class="text-white">üî•</span>
                                    <span class="font-bold text-white">${store.userStats.streak}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderNavigation() {
            const views = [
                { id: 'dashboard', icon: 'üìä', label: 'G√∂sterge Paneli' },
                { id: 'products', icon: 'üì¶', label: '√úr√ºnler' },
                { id: 'leaderboard', icon: 'üèÜ', label: 'Sƒ±ralama' },
                { id: 'badges', icon: 'üéñÔ∏è', label: 'Rozetler' }
            ];

            return `
                <div class="max-w-7xl mx-auto px-4 py-4">
                    <div class="flex gap-2 bg-white rounded-xl p-2 shadow-lg">
                        ${views.map(view => `
                            <button
                                onclick="store.currentView = '${view.id}'; render();"
                                class="flex-1 py-3 px-4 rounded-lg font-semibold transition-all ${
                                    store.currentView === view.id
                                        ? 'bg-gradient-to-r from-purple-600 to-pink-600 text-white shadow-lg'
                                        : 'text-gray-600 hover:bg-gray-100'
                                }"
                            >
                                ${view.icon} ${view.label}
                            </button>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function renderDashboard() {
            const expiredCount = store.products.filter(p => p.status === 'SKT GE√áTƒ∞').length;
            const warningCount = store.products.filter(p => p.status === 'SKT YAKLA≈ûIYOR').length;
            const goodCount = store.products.filter(p => p.status === 'UYGUN').length;

            return `
                <div class="space-y-6">
                    <!-- Stats Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 animate-slide-in">
                        <div class="bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl p-6 text-white shadow-xl">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-4xl">üéØ</span>
                                <span class="text-3xl font-bold">${store.userStats.todayScans}</span>
                            </div>
                            <p class="text-blue-100 mb-2">Bug√ºnk√º Taramalar</p>
                            <div class="bg-blue-400 rounded-full h-2">
                                <div class="bg-white h-2 rounded-full transition-all" style="width: ${(store.userStats.todayScans / store.userStats.dailyGoal) * 100}%"></div>
                            </div>
                        </div>

                        <div class="bg-gradient-to-br from-green-500 to-green-600 rounded-xl p-6 text-white shadow-xl">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-4xl">üìà</span>
                                <span class="text-3xl font-bold">${store.userStats.weeklyScans}</span>
                            </div>
                            <p class="text-green-100 mb-2">Haftalƒ±k Taramalar</p>
                            <div class="bg-green-400 rounded-full h-2">
                                <div class="bg-white h-2 rounded-full transition-all" style="width: ${(store.userStats.weeklyScans / store.userStats.weeklyGoal) * 100}%"></div>
                            </div>
                        </div>

                        <div class="bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl p-6 text-white shadow-xl">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-4xl">‚ö°</span>
                                <span class="text-3xl font-bold">${store.userStats.level}</span>
                            </div>
                            <p class="text-purple-100 mb-2">Seviye</p>
                            <p class="text-sm text-purple-200">${store.userStats.totalPoints % 100}/100 XP</p>
                        </div>

                        <div class="bg-gradient-to-br from-orange-500 to-red-500 rounded-xl p-6 text-white shadow-xl">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-4xl">üèÜ</span>
                                <span class="text-3xl font-bold">${store.userStats.badges.length}</span>
                            </div>
                            <p class="text-orange-100 mb-2">Kazanƒ±lan Rozet</p>
                            <p class="text-sm text-orange-200">Toplam Ba≈üarƒ±m</p>
                        </div>
                    </div>

                    <!-- Daily Quests -->
                    <div class="bg-white rounded-xl p-6 shadow-lg animate-slide-in">
                        <div class="flex items-center gap-3 mb-4">
                            <span class="text-3xl">üéÅ</span>
                            <h2 class="text-2xl font-bold text-gray-800">G√ºnl√ºk G√∂revler</h2>
                        </div>
                        <div class="space-y-3">
                            ${[
                                { task: '20 √ºr√ºn tara', progress: store.userStats.todayScans, goal: 20, reward: 100 },
                                { task: 'SKT yakla≈üan 5 √ºr√ºn bul', progress: Math.min(warningCount, 5), goal: 5, reward: 50 },
                                { task: 'Her lokasyondan √ºr√ºn tara', progress: new Set(store.products.map(p => p.location)).size, goal: 5, reward: 75 }
                            ].map(quest => `
                                <div class="bg-gray-50 rounded-lg p-4 hover:shadow-md transition-all">
                                    <div class="flex items-center justify-between mb-2">
                                        <span class="font-semibold text-gray-700">${quest.task}</span>
                                        <span class="text-sm font-bold text-purple-600">+${quest.reward} XP</span>
                                    </div>
                                    <div class="flex items-center gap-3">
                                        <div class="flex-1 bg-gray-200 rounded-full h-3">
                                            <div class="bg-gradient-to-r from-purple-500 to-pink-500 h-3 rounded-full transition-all" style="width: ${Math.min((quest.progress / quest.goal) * 100, 100)}%"></div>
                                        </div>
                                        <span class="text-sm text-gray-600">${quest.progress}/${quest.goal}</span>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <!-- Quick Stats -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 animate-slide-in">
                        <div class="bg-white rounded-xl p-6 shadow-lg">
                            <div class="flex items-center gap-3 mb-3">
                                <div class="bg-red-100 p-3 rounded-full">
                                    <span class="text-2xl">‚ö†Ô∏è</span>
                                </div>
                                <div>
                                    <p class="text-2xl font-bold text-gray-800">${expiredCount}</p>
                                    <p class="text-sm text-gray-600">SKT Ge√ßmi≈ü</p>
                                </div>
                            </div>
                        </div>

                        <div class="bg-white rounded-xl p-6 shadow-lg">
                            <div class="flex items-center gap-3 mb-3">
                                <div class="bg-yellow-100 p-3 rounded-full">
                                    <span class="text-2xl">‚è∞</span>
                                </div>
                                <div>
                                    <p class="text-2xl font-bold text-gray-800">${warningCount}</p>
                                    <p class="text-sm text-gray-600">SKT Yakla≈üan</p>
                                </div>
                            </div>
                        </div>

                        <div class="bg-white rounded-xl p-6 shadow-lg">
                            <div class="flex items-center gap-3 mb-3">
                                <div class="bg-green-100 p-3 rounded-full">
                                    <span class="text-2xl">‚úÖ</span>
                                </div>
                                <div>
                                    <p class="text-2xl font-bold text-gray-800">${goodCount}</p>
                                    <p class="text-sm text-gray-600">Uygun √úr√ºn</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderProducts() {
            const filteredProducts = store.getFilteredProducts();

            return `
                <div class="space-y-4">
                    <!-- Filters and Actions -->
                    <div class="bg-white rounded-xl p-4 shadow-lg flex flex-wrap gap-4 items-center">
                        <select 
                            onchange="store.filterStatus = this.value; render();"
                            class="px-4 py-2 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none"
                        >
                            <option value="all" ${store.filterStatus === 'all' ? 'selected' : ''}>T√ºm Durumlar</option>
                            <option value="SKT GE√áTƒ∞" ${store.filterStatus === 'SKT GE√áTƒ∞' ? 'selected' : ''}>SKT Ge√ßti</option>
                            <option value="SKT YAKLA≈ûIYOR" ${store.filterStatus === 'SKT YAKLA≈ûIYOR' ? 'selected' : ''}>SKT Yakla≈üƒ±yor</option>
                            <option value="UYGUN" ${store.filterStatus === 'UYGUN' ? 'selected' : ''}>Uygun</option>
                        </select>

                        <select 
                            onchange="store.filterLocation = this.value; render();"
                            class="px-4 py-2 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none"
                        >
                            <option value="all" ${store.filterLocation === 'all' ? 'selected' : ''}>T√ºm Lokasyonlar</option>
                            ${store.locations.map(loc => `
                                <option value="${loc}" ${store.filterLocation === loc ? 'selected' : ''}>${loc}</option>
                            `).join('')}
                        </select>

                        <button
                            onclick="store.exportToExcel()"
                            class="px-6 py-3 bg-gradient-to-r from-green-600 to-green-700 text-white rounded-xl font-bold hover:shadow-xl transition-all"
                        >
                            üì• Excel ƒ∞ndir
                        </button>

                        <button
                            onclick="store.showAddModal = true; render();"
                            class="ml-auto bg-gradient-to-r from-purple-600 to-pink-600 text-white px-6 py-3 rounded-xl font-bold hover:shadow-xl transition-all flex items-center gap-2"
                        >
                            <span>‚ûï</span>
                            Yeni √úr√ºn Ekle
                        </button>
                    </div>

                    <!-- Product List -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        ${filteredProducts.map(product => `
                            <div class="bg-white rounded-xl p-5 shadow-lg hover:shadow-xl transition-all border-l-4 ${product.borderColor} animate-slide-in">
                                <div class="flex items-start justify-between mb-3">
                                    <div>
                                        <h3 class="font-bold text-lg text-gray-800">${product.name}</h3>
                                        <p class="text-sm text-gray-600">${product.category}</p>
                                    </div>
                                    <span class="${product.color} text-white px-3 py-1 rounded-full text-xs font-bold">
                                        ${product.status}
                                    </span>
                                </div>
                                <div class="space-y-2 text-sm text-gray-600 mb-3">
                                    <p><strong>Barkod:</strong> ${product.barcode}</p>
                                    <p><strong>Lokasyon:</strong> ${product.location}</p>
                                    <p><strong>SKT:</strong> ${new Date(product.expiryDate).toLocaleDateString('tr-TR')}</p>
                                    <p><strong>Kalan:</strong> ${product.daysLeft} g√ºn</p>
                                </div>
                                <button
                                    onclick="store.deleteProduct(${product.id})"
                                    class="w-full bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg font-semibold transition-all"
                                >
                                    üóëÔ∏è Sil
                                </button>
                            </div>
                        `).join('')}
                    </div>

                    ${filteredProducts.length === 0 ? `
                        <div class="bg-white rounded-xl p-12 text-center shadow-lg">
                            <p class="text-gray-500 text-lg">Hen√ºz √ºr√ºn eklenmemi≈ü veya filtrelere uygun √ºr√ºn yok</p>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        function renderLeaderboard() {
            const leaderboard = [
                { name: 'Siz', points: store.userStats.totalPoints, scans: store.userStats.weeklyScans, avatar: 'üë§' },
                { name: 'Ahmet Y.', points: 1250, scans: 156, avatar: 'üë®' },
                { name: 'Ay≈üe K.', points: 1180, scans: 142, avatar: 'üë©' },
                { name: 'Mehmet S.', points: 980, scans: 118, avatar: 'üë®' },
                { name: 'Fatma D.', points: 850, scans: 95, avatar: 'üë©' }
            ].sort((a, b) => b.points - a.points);

            return `
                <div class="bg-white rounded-xl p-6 shadow-lg animate-slide-in">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">üèÜ Bu Haftanƒ±n Liderleri</h2>
                    <div class="space-y-3">
                        ${leaderboard.map((user, idx) => `
                            <div class="flex items-center gap-4 p-4 rounded-lg ${user.name === 'Siz' ? 'bg-gradient-to-r from-purple-100 to-pink-100 border-2 border-purple-500' : 'bg-gray-50'}">
                                <div class="text-2xl font-bold text-gray-400 w-8">${idx + 1}</div>
                                <div class="text-3xl">${user.avatar}</div>
                                <div class="flex-1">
                                    <p class="font-bold text-gray-800">${user.name}</p>
                                    <p class="text-sm text-gray-600">${user.scans} tarama</p>
                                </div>
                                <div class="text-right">
                                    <p class="text-2xl font-bold text-purple-600">${user.points}</p>
                                    <p class="text-xs text-gray-500">puan</p>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function renderBadges() {
            const allBadges = [
                { name: 'ƒ∞lk 10', desc: '10 √ºr√ºn tara', icon: 'üåü', earned: store.userStats.badges.includes('ƒ∞lk 10') },
                { name: 'G√ºnl√ºk Kahraman', desc: '20 √ºr√ºn tara (g√ºnl√ºk)', icon: '‚≠ê', earned: store.userStats.badges.includes('G√ºnl√ºk Kahraman') },
                { name: 'Haftalƒ±k Yƒ±ldƒ±z', desc: '50 √ºr√ºn tara (haftalƒ±k)', icon: 'üí´', earned: store.userStats.badges.includes('Haftalƒ±k Yƒ±ldƒ±z') },
                { name: 'S√ºper Denet√ßi', desc: '100 √ºr√ºn tara (haftalƒ±k)', icon: 'üèÜ', earned: store.userStats.badges.includes('S√ºper Denet√ßi') },
                { name: 'Risk Avcƒ±sƒ±', desc: '10 riskli √ºr√ºn bul', icon: 'üéØ', earned: false },
                { name: 'Ate≈ü Topu', desc: '7 g√ºn √ºst √ºste tara', icon: 'üî•', earned: store.userStats.badges.includes('Ate≈ü Topu') }
            ];

            return `
                <div class="space-y-6 animate-slide-in">
                    <div class="bg-white rounded-xl p-6 shadow-lg">
                        <h2 class="text-2xl font-bold text-gray-800 mb-6">üéñÔ∏è Rozetleriniz</h2>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            ${store.userStats.badges.length > 0 ? store.userStats.badges.map(badge => {
                                const badgeInfo = allBadges.find(b => b.name === badge);
                                return `
                                    <div class="bg-gradient-to-br from-yellow-100 to-orange-100 rounded-xl p-6 text-center">
                                        <div class="text-4xl mb-2">${badgeInfo?.icon || 'üèÖ'}</div>
                                        <p class="font-bold text-gray-800">${badge}</p>
                                    </div>
                                `;
                            }).join('') : `
                                <div class="col-span-full text-center py-12">
                                    <p class="text-gray-500">Hen√ºz rozet kazanmadƒ±nƒ±z</p>
                                    <p class="text-sm text-gray-400 mt-2">G√∂revleri tamamlayarak rozet kazanƒ±n!</p>
                                </div>
                            `}
                        </div>
                    </div>

                    <div class="bg-white rounded-xl p-6 shadow-lg">
                        <h2 class="text-2xl font-bold text-gray-800 mb-6">üéØ Kazanƒ±labilir Rozetler</h2>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            ${allBadges.map(badge => `
                                <div class="${badge.earned ? 'bg-gradient-to-br from-yellow-100 to-orange-100' : 'bg-gray-50 border-2 border-dashed border-gray-300'} rounded-xl p-6 text-center">
                                    <div class="text-4xl mb-2 ${!badge.earned ? 'opacity-50' : ''}">${badge.icon}</div>
                                    <p class="font-bold ${badge.earned ? 'text-gray-800' : 'text-gray-600'}">${badge.name}</p>
                                    <p class="text-xs text-gray-500 mt-1">${badge.desc}</p>
                                    ${badge.earned ? '<p class="text-xs text-green-600 mt-2">‚úÖ Kazanƒ±ldƒ±</p>' : ''}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
        }

        function renderAddModal() {
            if (!store.showAddModal) return '';

            return `
                <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50" onclick="if(event.target === this) { store.showAddModal = false; render(); }">
                    <div class="bg-white rounded-2xl p-6 max-w-md w-full shadow-2xl animate-scale-in">
                        <h2 class="text-2xl font-bold text-gray-800 mb-6">üì¶ Yeni √úr√ºn Ekle</h2>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Barkod No</label>
                                <div class="flex gap-2">
                                    <input
                                        type="text"
                                        value="${store.newProduct.barcode}"
                                        oninput="store.newProduct.barcode = this.value"
                                        class="flex-1 px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none"
                                        placeholder="Barkod numarasƒ±"
                                    />
                                    <button
                                        onclick="simulateBarcodeScan()"
                                        class="bg-gradient-to-r from-blue-500 to-blue-600 text-white p-3 rounded-lg hover:shadow-lg transition-all"
                                    >
                                        üì∑
                                    </button>
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">√úr√ºn Adƒ± *</label>
                                <input
                                    type="text"
                                    value="${store.newProduct.name}"
                                    oninput="store.newProduct.name = this.value"
                                    class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none"
                                    placeholder="√úr√ºn adƒ±"
                                />
                            </div>

                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Kategori</label>
                                <select
                                    onchange="store.newProduct.category = this.value"
                                    class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none"
                                >
                                    <option value="">Kategori se√ßin</option>
                                    ${store.categories.map(cat => `
                                        <option value="${cat}" ${store.newProduct.category === cat ? 'selected' : ''}>${cat}</option>
                                    `).join('')}
                                </select>
                            </div>

                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Lokasyon</label>
                                <select
                                    onchange="store.newProduct.location = this.value"
                                    class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none"
                                >
                                    <option value="">Lokasyon se√ßin</option>
                                    ${store.locations.map(loc => `
                                        <option value="${loc}" ${store.newProduct.location === loc ? 'selected' : ''}>${loc}</option>
                                    `).join('')}
                                </select>
                            </div>

                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Son Kullanma Tarihi *</label>
                                <input
                                    type="date"
                                    value="${store.newProduct.expiryDate}"
                                    oninput="store.newProduct.expiryDate = this.value"
                                    class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none"
                                />
                            </div>
                        </div>

                        <div class="flex gap-3 mt-6">
                            <button
                                onclick="store.showAddModal = false; render();"
                                class="flex-1 px-6 py-3 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-all"
                            >
                                ƒ∞ptal
                            </button>
                            <button
                                onclick="store.addProduct()"
                                class="flex-1 px-6 py-3 bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-lg font-semibold hover:shadow-xl transition-all"
                            >
                                Kaydet & Puan Kazan
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderFloatingButton() {
            return `
                <button
                    onclick="store.showAddModal = true; render();"
                    class="fixed bottom-8 right-8 bg-gradient-to-r from-purple-600 to-pink-600 text-white p-5 rounded-full shadow-2xl hover:scale-110 transition-all z-40 animate-pulse-custom"
                >
                    <span class="text-3xl">‚ûï</span>
                </button>
            `;
        }

        /* ============================================
           MAIN RENDER
        ============================================ */
        function render() {
            console.log('[APP] render() √ßaƒürƒ±ldƒ±, currentView:', store.currentView);
            
            const app = document.getElementById('app');
            
            let content = '';
            
            if (store.currentView === 'dashboard') {
                content = renderDashboard();
            } else if (store.currentView === 'products') {
                content = renderProducts();
            } else if (store.currentView === 'leaderboard') {
                content = renderLeaderboard();
            } else if (store.currentView === 'badges') {
                content = renderBadges();
            }
            
            app.innerHTML = `
                ${renderHeader()}
                ${renderNavigation()}
                <div class="max-w-7xl mx-auto px-4 py-6">
                    ${content}
                </div>
                ${renderFloatingButton()}
                ${renderAddModal()}
            `;
        }

        /* ============================================
           SERVICE WORKER REGISTRATION
        ============================================ */
        console.log('[APP] Service Worker registration ba≈ülanƒ±yor...');
        
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                console.log('[APP] Load event tetiklendi, SW register ediliyor...');
                navigator.serviceWorker.register('./sw.js')
                    .then(reg => console.log('[APP] SW ba≈üarƒ±yla register edildi:', reg.scope))
                    .catch(err => console.error('[APP] SW registration hatasƒ±:', err));
            });
        } else {
            console.warn('[APP] Service Worker tarayƒ±cƒ±da desteklenmiyor');
        }

        /* ============================================
           INITIALIZATION
        ============================================ */
        console.log('[APP] Initialization starting...');
        
        document.addEventListener('DOMContentLoaded', () => {
            console.log('[APP] DOMContentLoaded tetiklendi');
            render();
        });
    </script>
</body>
</html>
